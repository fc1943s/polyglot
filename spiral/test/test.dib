#!meta

{"kernelInfo":{"defaultKernelName":"csharp","items":[{"aliases":[],"name":"csharp"},{"aliases":[],"name":"fsharp"}]}}

#!pwsh

$ScriptDir =
    [Environment]::CommandLine -match '--working-dir\s+(\S+)' ?
        $Matches[1] :
        ($m = [Environment]::CommandLine -match '--run\s+(\S+)' ? $Matches[1] : $null) -and $m -match '[\\/]' ?
            (Split-Path -Path $m -Parent) :
            [Environment]::CurrentDirectory
Set-Location $ScriptDir
$ErrorActionPreference = "Stop"
. ../../scripts/core.ps1

#!pwsh

dotnet fable --optimize --lang rs --extension .rs

#!pwsh

cargo fmt --

#!pwsh

cargo build --release

#!pwsh

$env:RUST_LOG="info"
{ cargo test --release | Tee-Object test.test.ans } | Invoke-Block

#!pwsh

{ . "$ScriptDir/../../target/release/test$(if ($IsWindows) { '.exe' } else { '' })" | Tee-Object test.out } | Invoke-Block
