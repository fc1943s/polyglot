#!meta

{"kernelInfo":{"defaultKernelName":"csharp","items":[{"aliases":[],"name":"csharp"}]}}

#!fsharp

#r "nuget:Expecto"

#!fsharp

#!import nbs/Notebooks.dib

#!fsharp

//// test

type AssertExceptionFormatter (ex) =
    member _.Text =
        ex.ToString()
            .Replace("[32m", "<span style=\"color: green;\">")
            .Replace("[36m", "</span>")
            .Replace("[31m", "<span style=\"color: red;\">")
            .Replace("\n", "<br/>")


Formatter.Register<AssertExceptionFormatter> ((fun (x : AssertExceptionFormatter) -> x.Text), "text/html")

#!fsharp

//// test

let __equal log expected actual =
    if log then printfn $"{actual.ToDisplayString ()}"
    try
        "Testing._equal" |> Expecto.Expect.equal actual expected
    with :? Expecto.AssertException as ex ->
        AssertExceptionFormatter(ex).Display () |> ignore
        failwith (ex.GetType().FullName)

let _equal expected actual =
    __equal true expected actual
